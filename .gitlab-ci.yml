stages: 
  - build
  - style
  - tests
  - deploy
build:
  stage: build
  script:
    - cd ./src/C3_SimpleBashUtils-3-develop/src/cat/
    - make
    - cd ../grep/
    - make
  after_script:
     - chmod a+x ./src/notifyer.sh
     - ./src/notifyer.sh CI "$CI_JOB_STATUS" "$CI_COMMIT_AUTHOR" "$CI_COMMIT_BRANCH" "$CI_COMMIT_MESSAGE" "$CI_PIPELINE_ID" "$CI_JOB_STAGE" 
  artifacts:
    paths:
      - ./src/C3_SimpleBashUtils-3-develop/src/cat/s21_cat
      - ./src/C3_SimpleBashUtils-3-develop/src/grep/s21_grep
    expire_in: 30 days
  tags: 
    - ajhin2 
  allow_failure: false   
style:
  stage: style
  script:
    - cd ./src/C3_SimpleBashUtils-3-develop/src/cat/
    - make linter
    - cd ../grep/
    - make linter   
  after_script:
    - chmod a+x ./src/notifyer.sh
    - ./src/notifyer.sh CI "$CI_JOB_STATUS" "$CI_COMMIT_AUTHOR" "$CI_COMMIT_BRANCH" "$CI_COMMIT_MESSAGE" "$CI_PIPELINE_ID" "$CI_JOB_STAGE"
  needs: 
    - job: build
  tags:
    - ajhin2
  allow_failure: false 
tests:
  stage: tests
  needs: 
    - job: build
      artifacts: true
    - job: style
  script:
    - cd ./src/C3_SimpleBashUtils-3-develop/src/cat/tests/1
    - chmod +x ./s21_cat_lin_test1.sh 
    - ./s21_cat_lin_test1.sh 
    - cd ./../../../grep/tests/1
    - chmod +x ./s21_grep_lin_test1.sh 
    - ./s21_grep_lin_test1.sh 
  after_script:
    - chmod a+x ./src/notifyer.sh
    - ./src/notifyer.sh CI "$CI_JOB_STATUS" "$CI_COMMIT_AUTHOR" "$CI_COMMIT_BRANCH" "$CI_COMMIT_MESSAGE" "$CI_PIPELINE_ID" "$CI_JOB_STAGE"
  tags:
    - ajhin2
  allow_failure: false    
deploy:
  stage: deploy
  needs: 
    - job: build
      artifacts: true
    - job: style
    - job: tests
  script:
    - chmod a+x ./src/deployer.sh
    - ./src/deployer.sh 10.54.202.246 student
  after_script:
    - chmod a+x ./src/notifyer.sh
    - ./src/notifyer.sh CD "$CI_JOB_STATUS" "$CI_COMMIT_AUTHOR" "$CI_COMMIT_BRANCH" "$CI_COMMIT_MESSAGE" "$CI_PIPELINE_ID" "$CI_JOB_STAGE"
  tags:
    - ajhin2
  allow_failure: false 
